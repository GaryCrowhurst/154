<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Vehicle Chassis Components - Revision Quiz</title>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #155cb3;
            --secondary: #4caf50;
            --secondary-dark: #388e3c;
            --danger: #f44336;
            --success: #4caf50;
            --dark: #333;
            --light: #f5f5f5;
            --gray: #9e9e9e;
            --light-gray: #e0e0e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-color, var(--light));
            color: var(--text-color, var(--dark));
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: var(--primary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        p {
            margin-bottom: 15px;
        }
        
        .home-screen, .topic-selection, .question-screen, .results-screen {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: var(--secondary-dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-secondary {
            background-color: var(--gray);
        }
        
        .btn-secondary:hover {
            background-color: #757575;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .topic-progress {
            height: 6px;
            width: 100%;
            background-color: var(--light-gray);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .topic-progress-bar {
            height: 100%;
            background-color: var(--secondary);
            border-radius: 3px;
        }
        
        .progress-details-container {
            margin-top: 20px;
        }
        
        .progress-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .progress-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .progress-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .overall-progress {
            background-color: var(--primary-dark);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .overall-progress h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .dialog-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .dialog-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .topic-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid var(--light-gray);
        }
        
        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .options-container {
            margin-top: 20px;
        }
        
        .option {
            display: block;
            padding: 15px;
            margin-bottom: 10px;
            background-color: var(--option-bg, var(--light));
            border: 2px solid var(--light-gray);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--option-text, var(--dark));
        }
        
        .option:hover {
            background-color: var(--selected-bg, rgba(26, 115, 232, 0.1));
            border-color: var(--primary);
        }
        
        .option.selected {
            background-color: var(--selected-bg, rgba(26, 115, 232, 0.1));
            border-color: var(--primary);
        }
        
        .option.correct {
            background-color: var(--correct-bg, rgba(76, 175, 80, 0.2));
            border-color: var(--secondary);
        }
        
        .option.incorrect {
            background-color: var(--incorrect-bg, rgba(244, 67, 54, 0.2));
            border-color: var(--danger);
        }
        
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--selected-bg, rgba(26, 115, 232, 0.08));
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            transition: background-color 0.3s;
            color: var(--card-text, var(--dark));
        }
        
        /* Dark mode adjustments */
        .theme-dark .explanation {
            background-color: rgba(144, 202, 249, 0.1);
        }
        
        .theme-dark .option {
            background-color: #333;
        }
        
        .theme-dark .option:hover {
            background-color: #444;
        }
        
        .theme-dark .option.selected {
            background-color: rgba(144, 202, 249, 0.2);
        }
        
        .theme-dark .option.correct {
            background-color: rgba(129, 199, 132, 0.2);
        }
        
        .theme-dark .option.incorrect {
            background-color: rgba(229, 115, 115, 0.2);
        }
        
        /* High contrast adjustments */
        .theme-contrast .option {
            border-width: 3px;
        }
        
        .theme-contrast .option.selected {
            background-color: black;
            color: #ffff00;
            border-color: #ffff00;
        }
        
        .theme-contrast .option.correct {
            background-color: black;
            color: #66ff66;
            border-color: #66ff66;
        }
        
        .theme-contrast .option.incorrect {
            background-color: black;
            color: #ff6666;
            border-color: #ff6666;
        }
        
        .theme-contrast .explanation {
            background-color: #333;
            border-left: 8px solid #ffff00;
            color: white;
        }
        
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: var(--light-gray);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .score-display {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
        }
        
        .result-details {
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .topic-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .navigation {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Light Vehicle Chassis Components</h1>
            <p>Revision Quiz for Level 2 Motor Vehicle</p>
            <div class="header-controls">
                <div class="theme-toggle-container">
                    <span class="theme-label">Theme:</span>
                    <div class="theme-options">
                        <button id="light-theme" class="theme-btn theme-btn-active" title="Light Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        </button>
                        <button id="dark-theme" class="theme-btn" title="Dark Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                        </button>
                        <button id="contrast-theme" class="theme-btn" title="High Contrast Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        </button>
                        <button id="colorblind-theme" class="theme-btn" title="Colorblind Friendly Mode">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v8"></path><path d="M12 18v4"></path><path d="M4.93 10.93l1.41 1.41"></path><path d="M17.66 17.66l1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="M6.34 17.66l-1.41 1.41"></path><path d="M19.07 10.93l-1.41 1.41"></path><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"></path></svg>
                        </button>
                    </div>
                </div>
                <div class="header-buttons">
                    <button id="progress-btn" class="action-btn progress-btn" aria-label="View Overall Progress">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                        Progress
                    </button>
                    <button id="reset-btn" class="action-btn reset-btn" aria-label="Reset All Progress">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path><path d="M16 21h5v-5"></path></svg>
                        Reset
                    </button>
                </div>
            </div>
        </header>

        <!-- Topic Selection Screen (Now the landing page) -->
        <div id="topic-selection" class="topic-selection">
            <h2>Select a Topic to Practice</h2>
            <div class="topic-grid" id="topic-grid">
                <!-- Topics will be generated by JavaScript -->
            </div>
        </div>

        <!-- Home Screen (Now hidden and accessible via button) -->
        <div id="home-screen" class="home-screen hidden">
            <h2>Welcome to your Revision Quiz</h2>
            <p>This quiz will help you prepare for your Level 2 assessment on Removing and Replacing Light Vehicle Chassis Units and Components.</p>
            <p>The questions cover steering systems, suspension systems, braking systems, wheels and tyres, safety procedures, and general knowledge about chassis components.</p>
            <p>Your progress is automatically saved to your device after each answer.</p>
            <div class="button-group">
                <button id="start-btn" class="btn">Start Quiz</button>
                <button id="back-to-topics" class="btn btn-secondary">Back to Topics</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="question-screen hidden">
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
            <h2 id="question-text">Question text goes here</h2>
            <div id="options-container" class="options-container">
                <!-- Options will be generated by JavaScript -->
            </div>
            <div id="explanation" class="explanation hidden">
                Explanation text goes here
            </div>
            <div class="navigation">
                <button id="prev-btn" class="btn hidden">Previous</button>
                <button id="submit-btn" class="btn">Submit Answer</button>
                <button id="next-btn" class="btn hidden">Next Question</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="results-screen hidden">
            <h2>Quiz Results</h2>
            <div id="score-display" class="score-display">
                You scored: <span id="score">0</span>/<span id="total">0</span>
            </div>
            <div id="result-details" class="result-details">
                <!-- Result details will be generated by JavaScript -->
            </div>
            <div class="button-group">
                <button id="restart-btn" class="btn">Practice Again</button>
                <button id="back-to-topics-from-results" class="btn btn-secondary">Back to Topics</button>
            </div>
        </div>
        
        <!-- Overall Progress Screen -->
        <div id="progress-screen" class="progress-screen hidden">
            <h2>Your Overall Progress</h2>
            <div id="progress-details-container" class="progress-details-container">
                <!-- Progress details will be generated by JavaScript -->
            </div>
            <div class="button-group">
                <button id="back-to-topics-btn" class="btn">Back to Topics</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const homeScreen = document.getElementById('home-screen');
        const topicSelection = document.getElementById('topic-selection');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        const progressScreen = document.getElementById('progress-screen');
        
        const startBtn = document.getElementById('start-btn');
        const progressBtn = document.getElementById('progress-btn');
        const resetBtn = document.getElementById('reset-btn');
        const topicGrid = document.getElementById('topic-grid');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanation = document.getElementById('explanation');
        const prevBtn = document.getElementById('prev-btn');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const scoreElement = document.getElementById('score');
        const totalElement = document.getElementById('total');
        const resultDetails = document.getElementById('result-details');
        const restartBtn = document.getElementById('restart-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const progressDetailsContainer = document.getElementById('progress-details-container');
        
        // Quiz State
        let currentView = 'home';
        let currentTopic = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        let answerSubmitted = false;
        let quizCompleted = false;
        let quizQuestions = [];
        let userAnswers = [];
        
        // User Progress Data
        let userProgress = {
            topics: {}
        };
        
        // Topics
        const topics = [
            { id: 'steering', name: 'Steering Systems' },
            { id: 'suspension', name: 'Suspension Systems' },
            { id: 'braking', name: 'Braking Systems' },
            { id: 'wheels', name: 'Wheels and Tyres' },
            { id: 'safety', name: 'Working Safely' },
            { id: 'general', name: 'General Procedures' },
            { id: 'random', name: 'Random Mix (All Topics)' }
        ];
        
        // Questions Database
        const questionsData = {
            steering: [
                {
                    question: "Which of the following is NOT a component of steering geometry?",
                    options: [
                        "Castor angle",
                        "Camber angle",
                        "Cylinder offset",
                        "Kingpin inclination"
                    ],
                    correctAnswer: 2,
                    explanation: "Steering geometry includes castor angle, camber angle, kingpin/swivel pin inclination, wheel/rim offset, and wheel alignment (tracking), but not 'cylinder offset' which is not a standard steering geometry term."
                },
                {
                    question: "What is the Ackerman principle related to?",
                    options: [
                        "Braking efficiency",
                        "Suspension rebound",
                        "Steering during turns",
                        "Tyre pressure monitoring"
                    ],
                    correctAnswer: 2,
                    explanation: "The Ackerman principle relates to steering geometry during turns, where the inner wheel turns at a greater angle than the outer wheel to follow the correct turning radius."
                },
                {
                    question: "Which component is NOT typically found in hydraulic power steering systems?",
                    options: [
                        "Drive belts and pumps",
                        "Hydraulic valve",
                        "Electronic control unit (ECU)",
                        "Power cylinders"
                    ],
                    correctAnswer: 2,
                    explanation: "While modern power steering systems may incorporate ECUs, a traditional hydraulic power steering system consists of piston and power cylinders, drive belts and pumps, hydraulic valves, and hydraulic fluid, but not necessarily an ECU."
                },
                {
                    question: "What steering defect is most likely causing wear on the outer edge of the tyre?",
                    options: [
                        "Too much toe-in",
                        "Excessive negative camber",
                        "Excessive positive camber",
                        "Incorrect castor angle"
                    ],
                    correctAnswer: 2,
                    explanation: "Excessive positive camber (when the top of the wheel tilts outward) causes wear on the outer edge of the tyre."
                },
                {
                    question: "Which term describes a vehicle's tendency to turn more sharply than the driver intends?",
                    options: [
                        "Understeer",
                        "Oversteer",
                        "Neutral steer",
                        "Self-aligning torque"
                    ],
                    correctAnswer: 1,
                    explanation: "Oversteer is when a vehicle turns more sharply than intended, often causing the rear end to slide outward during cornering."
                },
                {
                    question: "What is 'toe out on turns' referring to?",
                    options: [
                        "The tendency of tyres to wear on the outer edges",
                        "A steering system fault causing excessive play",
                        "The outer wheel turning at a lesser angle than the inner wheel",
                        "The inner wheel turning at a greater angle than the outer wheel"
                    ],
                    correctAnswer: 3,
                    explanation: "Toe out on turns refers to the geometry where the inner wheel turns at a greater angle than the outer wheel when cornering, allowing each wheel to follow its correct turning radius."
                },
                {
                    question: "What is 'understeer' in relation to vehicle handling?",
                    options: [
                        "When the vehicle turns less than expected for a given steering input",
                        "When the steering wheel feels too light",
                        "When the steering system doesn't return to center properly",
                        "When the steering wheel requires excessive force"
                    ],
                    correctAnswer: 0,
                    explanation: "Understeer occurs when a vehicle turns less than expected for a given steering input, typically causing the front end to push toward the outside of the turn."
                },
                {
                    question: "What would cause flats on the tread of a tyre?",
                    options: [
                        "Excessive camber",
                        "Incorrect castor angle",
                        "Braking issues or wheel lock-up",
                        "Incorrect toe settings"
                    ],
                    correctAnswer: 2,
                    explanation: "Flats on the tread of tyres are typically caused by braking issues or wheel lock-up during braking, which causes the tyre to skid rather than roll."
                },
                {
                    question: "Which of these is NOT an advantage of power-assisted steering?",
                    options: [
                        "Reduced driver effort",
                        "Better fuel economy",
                        "Improved handling at high speeds",
                        "Easier parking maneuvers"
                    ],
                    correctAnswer: 1,
                    explanation: "Traditional hydraulic power steering systems typically reduce fuel economy slightly due to the continuous operation of the hydraulic pump, which draws power from the engine."
                },
                {
                    question: "What is 'self-aligning torque' in steering systems?",
                    options: [
                        "The force that returns the steering to the straight-ahead position",
                        "A fault in the steering system causing wheel vibration",
                        "The mechanical advantage provided by the steering rack",
                        "The electronic adjustment of steering feel"
                    ],
                    correctAnswer: 0,
                    explanation: "Self-aligning torque is the natural tendency of a vehicle's steering system to return to the straight-ahead position after completing a turn, primarily due to the castor angle."
                },
                {
                    question: "Which component in a steering system is most responsible for converting rotary motion to linear motion?",
                    options: [
                        "Steering wheel",
                        "Power steering pump",
                        "Rack and pinion mechanism",
                        "Tie rod ends"
                    ],
                    correctAnswer: 2,
                    explanation: "The rack and pinion mechanism converts the rotary motion of the steering wheel and steering column into the linear motion needed to turn the wheels."
                },
                {
                    question: "What type of hydraulic valve is commonly used in power steering systems?",
                    options: [
                        "Pressure relief valve",
                        "Rotary valve",
                        "Check valve",
                        "Needle valve"
                    ],
                    correctAnswer: 1,
                    explanation: "Rotary valves are commonly used in power steering systems to control the flow of hydraulic fluid based on steering input."
                }
            ],
            suspension: [
                {
                    question: "Which of the following is NOT a type of independent suspension?",
                    options: [
                        "MacPherson strut",
                        "Leaf spring",
                        "Double wishbone",
                        "Trailing arm"
                    ],
                    correctAnswer: 1,
                    explanation: "Leaf springs are typically used in non-independent suspension systems. MacPherson strut, double wishbone, and trailing arm can all be used in independent suspension designs."
                },
                {
                    question: "What suspension component is designed to limit body roll during cornering?",
                    options: [
                        "Shock absorber",
                        "Coil spring",
                        "Anti-roll bar",
                        "Trailing arm"
                    ],
                    correctAnswer: 2,
                    explanation: "The anti-roll bar (also called stabilizer bar) connects the left and right suspension components to reduce body roll during cornering."
                },
                {
                    question: "Which term describes the downward movement of a vehicle's front during braking?",
                    options: [
                        "Roll",
                        "Pitch",
                        "Dive",
                        "Bounce"
                    ],
                    correctAnswer: 2,
                    explanation: "Dive is the term used to describe the downward movement of a vehicle's front during braking."
                },
                {
                    question: "What is the primary function of a damper in a suspension system?",
                    options: [
                        "To support the vehicle's weight",
                        "To control the rate of suspension movement",
                        "To prevent wheel hop during acceleration",
                        "To maintain wheel alignment"
                    ],
                    correctAnswer: 1,
                    explanation: "Dampers (shock absorbers) control the rate of suspension movement by converting kinetic energy into heat energy, preventing excessive bouncing."
                },
                {
                    question: "Which suspension symptom might indicate worn shock absorbers?",
                    options: [
                        "Vehicle pulls to one side",
                        "Excessive tyre wear in the center",
                        "Continued bouncing after hitting a bump",
                        "Steering wheel vibration"
                    ],
                    correctAnswer: 2,
                    explanation: "Worn shock absorbers typically allow the vehicle to continue bouncing after hitting a bump instead of quickly settling."
                },
                {
                    question: "What is the main advantage of independent rear suspension over a rigid axle?",
                    options: [
                        "Lower cost",
                        "Better load carrying capacity",
                        "Improved ride comfort and handling",
                        "Simpler maintenance"
                    ],
                    correctAnswer: 2,
                    explanation: "Independent rear suspension (IRS) offers improved ride comfort and handling because each wheel can move independently, allowing one wheel to absorb bumps without affecting the other wheel."
                },
                {
                    question: "What is a torsion bar used for in suspension systems?",
                    options: [
                        "To connect the suspension to the chassis",
                        "To act as a spring element",
                        "To prevent excessive suspension travel",
                        "To reduce steering feedback"
                    ],
                    correctAnswer: 1,
                    explanation: "A torsion bar is used as a spring element in some suspension systems. It works by twisting along its axis to provide resistance to suspension movement."
                },
                {
                    question: "Which term describes the upward movement of a vehicle's rear during heavy acceleration?",
                    options: [
                        "Squat",
                        "Lift",
                        "Pitch",
                        "Float"
                    ],
                    correctAnswer: 0,
                    explanation: "Squat describes the tendency of a vehicle's rear to compress (squat down) during heavy acceleration, while the front end rises."
                },
                {
                    question: "Which of these suspension designs is most commonly used in the front of modern front-wheel-drive vehicles?",
                    options: [
                        "Double wishbone",
                        "MacPherson strut",
                        "Leaf spring",
                        "Swing axle"
                    ],
                    correctAnswer: 1,
                    explanation: "The MacPherson strut is the most commonly used front suspension design in modern front-wheel-drive vehicles due to its compact design and cost-effectiveness."
                },
                {
                    question: "What is 'suspension compliance' referring to?",
                    options: [
                        "The ability of the suspension to absorb bumps",
                        "The legal requirements for suspension systems",
                        "The rate at which suspension components wear",
                        "The suspension's adherence to manufacturer specifications"
                    ],
                    correctAnswer: 0,
                    explanation: "Suspension compliance refers to the ability of the suspension system to absorb bumps and impacts, allowing controlled movement to improve ride comfort and handling."
                },
                {
                    question: "What might cause uneven ride height in a vehicle?",
                    options: [
                        "Worn ball joints",
                        "Broken or worn springs",
                        "Incorrect tyre pressure",
                        "All of the above"
                    ],
                    correctAnswer: 3,
                    explanation: "Uneven ride height can be caused by worn ball joints, broken or worn springs, and incorrect tyre pressure, among other factors."
                },
                {
                    question: "In a hydro-pneumatic suspension system, what provides the spring effect?",
                    options: [
                        "Hydraulic fluid",
                        "Compressed gas",
                        "Metal springs",
                        "Rubber bushings"
                    ],
                    correctAnswer: 1,
                    explanation: "In a hydro-pneumatic suspension system, compressed gas (typically nitrogen) provides the spring effect, while hydraulic fluid is used to transmit force and control movement."
                }
            ],
            braking: [
                {
                    question: "In a disc brake system, what component houses the pistons that press the brake pads against the disc?",
                    options: [
                        "Wheel cylinder",
                        "Master cylinder",
                        "Caliper",
                        "Drum"
                    ],
                    correctAnswer: 2,
                    explanation: "The caliper houses the pistons that press the brake pads against the brake disc when hydraulic pressure is applied."
                },
                {
                    question: "What is the purpose of a brake servo?",
                    options: [
                        "To distribute brake force between front and rear",
                        "To multiply the force applied to the brake pedal",
                        "To prevent wheel lock-up during braking",
                        "To automatically adjust brake clearance"
                    ],
                    correctAnswer: 1,
                    explanation: "A brake servo (or brake booster) multiplies the force applied to the brake pedal, reducing the effort required from the driver."
                },
                {
                    question: "Which component in a drum brake system automatically adjusts the clearance between the shoes and drum?",
                    options: [
                        "Wheel cylinder",
                        "Self-adjusting mechanism",
                        "Backing plate",
                        "Return spring"
                    ],
                    correctAnswer: 1,
                    explanation: "The self-adjusting mechanism automatically adjusts the clearance between the brake shoes and drum as the linings wear."
                },
                {
                    question: "What is the main disadvantage of brake fluid that is described as 'hygroscopic'?",
                    options: [
                        "It damages paint surfaces",
                        "It absorbs moisture from the air",
                        "It has a low boiling point",
                        "It becomes more viscous over time"
                    ],
                    correctAnswer: 1,
                    explanation: "Hygroscopic brake fluid absorbs moisture from the air, which can lead to brake system corrosion and reduced braking efficiency as water has a lower boiling point than brake fluid."
                },
                {
                    question: "Which braking system component prevents wheel lock-up during emergency braking?",
                    options: [
                        "Load sensing valve",
                        "Brake proportioning valve",
                        "Anti-lock Braking System (ABS)",
                        "Brake servo"
                    ],
                    correctAnswer: 2,
                    explanation: "The Anti-lock Braking System (ABS) prevents wheel lock-up during emergency braking by modulating brake pressure to individual wheels."
                },
                {
                    question: "What is the purpose of a load sensing valve in a braking system?",
                    options: [
                        "To increase braking force when the vehicle is heavily loaded",
                        "To reduce rear brake pressure when the vehicle is lightly loaded",
                        "To boost the brake pedal force under emergency braking",
                        "To prevent overheating of the brake components"
                    ],
                    correctAnswer: 1,
                    explanation: "A load sensing valve (or brake proportioning valve) reduces hydraulic pressure to the rear brakes when the vehicle is lightly loaded to prevent rear wheel lock-up, and increases pressure when the vehicle is heavily loaded."
                },
                {
                    question: "Which of these is NOT a component of a typical ABS system?",
                    options: [
                        "Wheel speed sensors",
                        "Hydraulic modulator",
                        "Electronic control unit",
                        "Brake fade compensator"
                    ],
                    correctAnswer: 3,
                    explanation: "A 'brake fade compensator' is not a standard component of an ABS system. ABS typically consists of wheel speed sensors, a hydraulic modulator, and an electronic control unit."
                },
                {
                    question: "What is 'brake fade'?",
                    options: [
                        "The gradual loss of braking effectiveness due to heat buildup",
                        "The failure of brake lights to illuminate when braking",
                        "The tendency of brakes to squeal when applied",
                        "The wear pattern on brake discs"
                    ],
                    correctAnswer: 0,
                    explanation: "Brake fade is the temporary reduction or loss of braking power due to excessive heat buildup in the braking system, typically during prolonged or repeated heavy braking."
                },
                {
                    question: "What would cause a vehicle to pull to one side during braking?",
                    options: [
                        "Worn master cylinder",
                        "Uneven brake pad wear or contamination",
                        "Worn brake servo",
                        "Low brake fluid level"
                    ],
                    correctAnswer: 1,
                    explanation: "A vehicle pulling to one side during braking is typically caused by uneven brake pad wear or contamination, stuck caliper, or a brake hydraulic problem affecting one side of the vehicle."
                },
                {
                    question: "In a dual-line hydraulic brake system, which wheels are typically served by separate hydraulic circuits?",
                    options: [
                        "Left side and right side wheels",
                        "Front and rear wheels",
                        "Diagonal wheels (front-left/rear-right and front-right/rear-left)",
                        "All wheels have separate circuits"
                    ],
                    correctAnswer: 2,
                    explanation: "Modern dual-line brake systems typically use a diagonal split (front-left/rear-right and front-right/rear-left) to ensure that if one circuit fails, the vehicle still has braking capability on both sides."
                },
                {
                    question: "What is the self-servo action in drum brakes?",
                    options: [
                        "The automatic adjustment of brake shoes as they wear",
                        "The tendency of the brake shoes to be pulled into the drum, increasing braking force",
                        "The power assistance provided by the brake servo",
                        "The electronic control of braking pressure"
                    ],
                    correctAnswer: 1,
                    explanation: "Self-servo action in drum brakes is the tendency of the leading shoe to be pulled into the drum as it contacts the rotating surface, which increases the braking force beyond what is applied hydraulically."
                },
                {
                    question: "What type of brake fluid is commonly specified for most modern vehicles?",
                    options: [
                        "DOT 3",
                        "DOT 4",
                        "DOT 5",
                        "DOT 5.1"
                    ],
                    correctAnswer: 1,
                    explanation: "DOT 4 brake fluid is commonly specified for most modern vehicles due to its higher boiling point and better performance characteristics compared to DOT 3."
                }
            ],
            wheels: [
                {
                    question: "What does the 'speed rating' on a tyre indicate?",
                    options: [
                        "The minimum speed the vehicle should maintain",
                        "The maximum speed the tyre is designed to handle",
                        "The recommended inflation pressure at highway speeds",
                        "The tread wear expectancy in miles"
                    ],
                    correctAnswer: 1,
                    explanation: "The speed rating indicates the maximum speed the tyre is designed to handle safely when properly inflated and not carrying excessive load."
                },
                {
                    question: "Which type of tyre construction has plies running at roughly 90 degrees to the direction of travel?",
                    options: [
                        "Radial",
                        "Bias belted",
                        "Cross ply",
                        "Run flat"
                    ],
                    correctAnswer: 2,
                    explanation: "Cross ply (or bias ply) tyres have plies running at roughly 45-degree angles to each other, crossing at approximately 90 degrees to the direction of travel."
                },
                {
                    question: "What does a tyre's load rating indicate?",
                    options: [
                        "The maximum weight the tyre can support",
                        "The recommended tyre pressure",
                        "The tyre's resistance to punctures",
                        "The number of plies in the tyre"
                    ],
                    correctAnswer: 0,
                    explanation: "The load rating indicates the maximum weight the tyre can support when properly inflated."
                },
                {
                    question: "Which of these would NOT cause a wheel vibration?",
                    options: [
                        "Unbalanced wheel",
                        "Bent wheel rim",
                        "Worn tyre tread",
                        "Incorrect tyre pressure"
                    ],
                    correctAnswer: 2,
                    explanation: "While worn tyre tread can cause various problems, it typically doesn't cause wheel vibration. Unbalanced wheels, bent rims, and sometimes incorrect tyre pressure can cause vibrations."
                },
                {
                    question: "What type of wheel bearing arrangement is most commonly used in modern vehicles?",
                    options: [
                        "Plain bearings",
                        "Needle bearings",
                        "Ball bearings",
                        "Taper roller bearings"
                    ],
                    correctAnswer: 3,
                    explanation: "Taper roller bearings are most commonly used in modern vehicle wheel bearing arrangements due to their ability to handle both radial and axial loads."
                },
                {
                    question: "What does 'unsprung weight' refer to in relation to wheels?",
                    options: [
                        "The weight of the vehicle not supported by the suspension",
                        "The weight difference between front and rear wheels",
                        "The weight capacity of the wheel bearings",
                        "The weight reduction achieved by using alloy wheels"
                    ],
                    correctAnswer: 0,
                    explanation: "Unsprung weight refers to the weight of components not supported by the suspension system, including wheels, tyres, brakes, and some suspension components. Lower unsprung weight generally improves handling and ride quality."
                },
                {
                    question: "What is the advantage of radial ply tyres over cross ply tyres?",
                    options: [
                        "Lower cost",
                        "Better puncture resistance",
                        "Better road holding and lower rolling resistance",
                        "Longer tread life"
                    ],
                    correctAnswer: 2,
                    explanation: "Radial ply tyres typically offer better road holding, lower rolling resistance (improving fuel economy), and often a more comfortable ride compared to cross ply tyres."
                },
                {
                    question: "What information would a tyre marking of '225/45R17 91W' provide?",
                    options: [
                        "Tyre width, aspect ratio, construction type, rim diameter, load index, and speed rating",
                        "Tyre manufacturer, size code, and production date",
                        "Tread pattern, wear rating, and maximum speed",
                        "Maximum load, pressure rating, and tyre type"
                    ],
                    correctAnswer: 0,
                    explanation: "The marking '225/45R17 91W' indicates: 225mm width, 45% aspect ratio, Radial construction, 17-inch rim diameter, 91 load index, and W speed rating."
                },
                {
                    question: "What is 'dynamic balancing' of a wheel?",
                    options: [
                        "Testing wheel balance while driving",
                        "Balancing a wheel while it's spinning",
                        "Adjusting tyre pressure to match road conditions",
                        "Rotating tyres to ensure even wear"
                    ],
                    correctAnswer: 1,
                    explanation: "Dynamic balancing involves testing and correcting the balance of a wheel while it's spinning, ensuring even weight distribution around the entire wheel assembly to prevent vibration at speed."
                },
                {
                    question: "What is the purpose of tread wear indicators on tyres?",
                    options: [
                        "To show manufacturing dates",
                        "To indicate when tyres have worn to the legal minimum tread depth",
                        "To mark reinforced areas of the tyre",
                        "To help with tyre alignment"
                    ],
                    correctAnswer: 1,
                    explanation: "Tread wear indicators are raised bars in the tyre grooves that become flush with the tread surface when the tyre has worn down to the legal minimum tread depth, indicating when the tyre needs replacement."
                },
                {
                    question: "What can cause a tyre to overheat?",
                    options: [
                        "Overinflation",
                        "Underinflation",
                        "Excessive speed",
                        "Both B and C"
                    ],
                    correctAnswer: 3,
                    explanation: "Tyres can overheat due to underinflation (causing excessive flexing of the sidewall) and/or excessive speed (generating more friction than the tyre can dissipate)."
                },
                {
                    question: "What does a 'well-based wheel rim' refer to?",
                    options: [
                        "A rim with proper weight distribution",
                        "A rim designed to hold tubeless tyres",
                        "A rim for high-performance vehicles",
                        "A rim made from high-quality materials"
                    ],
                    correctAnswer: 1,
                    explanation: "A well-based wheel rim has a specific design with a 'well' or depression around the circumference that allows tubeless tyres to be mounted and creates an airtight seal between the tyre and rim."
                }
            ],
            safety: [
                {
                    question: "When working on hybrid/electric vehicles, which of the following is most important?",
                    options: [
                        "Using specialized diagnostic equipment",
                        "Following isolation procedures before working on high-voltage systems",
                        "Keeping the battery fully charged",
                        "Using petroleum-based cleaners"
                    ],
                    correctAnswer: 1,
                    explanation: "Following proper isolation procedures before working on high-voltage systems is critical for safety when working on hybrid/electric vehicles."
                },
                {
                    question: "Which PPE should be worn when handling brake fluid?",
                    options: [
                        "Hard hat and steel-toed boots",
                        "Respiratory mask and face shield",
                        "Nitrile gloves and eye protection",
                        "Hearing protection and overalls"
                    ],
                    correctAnswer: 2,
                    explanation: "Nitrile gloves and eye protection should be worn when handling brake fluid to protect against skin irritation and eye damage."
                },
                {
                    question: "What is the correct way to dispose of waste brake fluid?",
                    options: [
                        "Pour it down a drain with running water",
                        "Mix it with water and dispose in regular trash",
                        "Take it to a designated hazardous waste facility",
                        "Allow it to evaporate in an open container"
                    ],
                    correctAnswer: 2,
                    explanation: "Brake fluid must be disposed of at a designated hazardous waste facility as it is environmentally harmful and cannot be disposed of in regular waste or drains."
                },
                {
                    question: "What should you do before removing brake components that may contain asbestos?",
                    options: [
                        "Spray the components with water to prevent dust",
                        "Use compressed air to blow away any dust",
                        "Sandblast the components to clean them",
                        "Simply work quickly to minimize exposure"
                    ],
                    correctAnswer: 0,
                    explanation: "Brake components that may contain asbestos should be dampened with water to prevent dust becoming airborne, as asbestos dust is extremely harmful when inhaled."
                },
                {
                    question: "What is the primary safety concern when working under a raised vehicle?",
                    options: [
                        "Protecting the vehicle's paintwork",
                        "Ensuring adequate lighting",
                        "Using proper support stands in addition to a jack",
                        "Wearing a face mask"
                    ],
                    correctAnswer: 2,
                    explanation: "Never rely solely on a jack to support a raised vehicle. Always use proper support stands (axle stands) to prevent the vehicle from falling and causing serious injury or death."
                },
                {
                    question: "What is the main hazard when disconnecting a battery on a vehicle with an airbag system?",
                    options: [
                        "Risk of airbag deployment",
                        "Loss of electronic memory settings",
                        "Battery acid spillage",
                        "Damage to the vehicle's ECU"
                    ],
                    correctAnswer: 0,
                    explanation: "There is a risk of accidental airbag deployment when disconnecting a battery. Always follow manufacturer procedures, which typically include waiting for capacitors to discharge and ensuring the ignition is off before disconnecting."
                },
                {
                    question: "When preparing to work on a vehicle's chassis, what should you do first?",
                    options: [
                        "Disconnect the battery",
                        "Ensure the vehicle is on level ground",
                        "Place wheel chocks around the wheels not being raised",
                        "Inspect the area for potential hazards"
                    ],
                    correctAnswer: 1,
                    explanation: "Before working on a vehicle's chassis, ensure the vehicle is on level, solid ground to prevent movement during work and to ensure the vehicle remains stable when raised."
                },
                {
                    question: "What protective measures should be taken when working with coil springs?",
                    options: [
                        "Use appropriate spring compressor tools and eye protection",
                        "Simply apply brake cleaner to remove debris",
                        "Work quickly to reduce exposure time",
                        "Heat the springs to reduce tension"
                    ],
                    correctAnswer: 0,
                    explanation: "Coil springs store substantial energy and can cause serious injury if released uncontrolled. Always use appropriate spring compressor tools and wear eye protection when working with them."
                },
                {
                    question: "What precaution should you take before disconnecting a brake pipe?",
                    options: [
                        "Ensure the braking system is not under pressure",
                        "Connect a diagnostic tool",
                        "Start the engine to build pressure",
                        "Apply the brake pedal repeatedly"
                    ],
                    correctAnswer: 0,
                    explanation: "Before disconnecting any brake pipe, ensure the braking system is not under pressure by allowing the vehicle to sit unused for some time after the last brake application."
                },
                {
                    question: "What is the correct method to clean up a brake fluid spill?",
                    options: [
                        "Use water to wash it away",
                        "Apply an absorbent material then dispose of it properly",
                        "Use compressed air to dry it quickly",
                        "Leave it to evaporate naturally"
                    ],
                    correctAnswer: 1,
                    explanation: "Clean brake fluid spills by applying an absorbent material (like a spill kit or cat litter), then dispose of the contaminated material properly as hazardous waste."
                },
                {
                    question: "What is the purpose of using Vehicle Protective Equipment (VPE)?",
                    options: [
                        "To protect the technician from injury",
                        "To protect the vehicle from damage during service",
                        "To improve the efficiency of repairs",
                        "To meet legal requirements for vehicle modifications"
                    ],
                    correctAnswer: 1,
                    explanation: "Vehicle Protective Equipment (VPE) such as seat covers, wing covers, and steering wheel covers are used to protect the vehicle from damage, dirt, and grease during service work."
                },
                {
                    question: "What should you do with old suspension components that have been replaced?",
                    options: [
                        "Dispose of them in general waste",
                        "Store them for spare parts",
                        "Recycle them according to local regulations",
                        "Return them to the vehicle manufacturer"
                    ],
                    correctAnswer: 2,
                    explanation: "Old suspension components should be recycled according to local regulations for metal recycling, helping to reduce environmental impact."
                }
            ],
            general: [
                {
                    question: "When replacing chassis components, why is it important to use components that meet original specifications?",
                    options: [
                        "Only to maintain warranty requirements",
                        "To ensure correct performance and safety",
                        "To save money on parts",
                        "To reduce installation time"
                    ],
                    correctAnswer: 1,
                    explanation: "Using components that meet original specifications ensures correct performance and safety, as well as maintaining warranty requirements in applicable cases."
                },
                {
                    question: "What action should be taken before handing a vehicle back to a customer after chassis work?",
                    options: [
                        "Simply inform them of the work done",
                        "Check only the components that were replaced",
                        "Road test the vehicle and carry out final checks",
                        "Have the customer sign a disclaimer"
                    ],
                    correctAnswer: 2,
                    explanation: "After chassis work, the vehicle should be road tested and final checks carried out to ensure all systems are functioning correctly and safely before returning to the customer."
                },
                {
                    question: "Which of these is NOT a required step when preparing to remove chassis components?",
                    options: [
                        "Protecting surrounding components",
                        "Checking for special tools needed",
                        "Repainting the components",
                        "Consulting technical information"
                    ],
                    correctAnswer: 2,
                    explanation: "Repainting components is not a standard preparation step before removal. Preparation typically includes protecting surrounding components, checking for special tools, and consulting technical information."
                },
                {
                    question: "What information would you need to check before carrying out wheel alignment?",
                    options: [
                        "The customer's driving style",
                        "The manufacturer's specifications",
                        "The vehicle's service history",
                        "The vehicle's top speed"
                    ],
                    correctAnswer: 1,
                    explanation: "The manufacturer's specifications must be checked before carrying out wheel alignment to ensure the alignment is set correctly for that specific vehicle."
                },
                {
                    question: "Which system is most likely to require calibration after component replacement?",
                    options: [
                        "Exhaust system",
                        "Cooling system",
                        "Advanced Driver Assistance Systems (ADAS)",
                        "Fuel system"
                    ],
                    correctAnswer: 2,
                    explanation: "Advanced Driver Assistance Systems (ADAS) often require calibration after chassis component replacement, especially when steering, suspension, or alignment has been affected."
                },
                {
                    question: "What is the importance of logical and systematic processes when working on chassis components?",
                    options: [
                        "They help complete the job faster",
                        "They ensure no steps are missed and aid fault diagnosis",
                        "They help reduce the cost of the repair",
                        "They are only important for apprentices"
                    ],
                    correctAnswer: 1,
                    explanation: "Logical and systematic processes ensure no steps are missed during complex repairs, aid fault diagnosis, improve safety, and help maintain quality standards."
                },
                {
                    question: "Why is it important to check for fault codes after replacing chassis components?",
                    options: [
                        "To identify any new issues that may have arisen during repair",
                        "To reset the service indicator",
                        "To update the vehicle's software",
                        "It's only necessary for warranty repairs"
                    ],
                    correctAnswer: 0,
                    explanation: "Checking for fault codes after chassis work helps identify any new issues that may have arisen during repair or confirm that previously identified faults have been resolved."
                },
                {
                    question: "What documentation should be completed after chassis repairs?",
                    options: [
                        "Only the invoice",
                        "Vehicle technical data updates",
                        "Job card, service record, and any warranty documentation",
                        "Only documents required by law"
                    ],
                    correctAnswer: 2,
                    explanation: "After chassis repairs, complete documentation should include the job card detailing work done, updating the service record, and completing any warranty documentation if applicable."
                },
                {
                    question: "What is the purpose of torquing fasteners to the correct specification?",
                    options: [
                        "To prevent over-tightening and component damage",
                        "To reduce the time needed for the job",
                        "To make the fasteners easier to remove later",
                        "It's only necessary for safety-critical components"
                    ],
                    correctAnswer: 0,
                    explanation: "Torquing fasteners to the correct specification prevents both under-tightening (which could lead to loosening) and over-tightening (which could cause component damage or fastener failure)."
                },
                {
                    question: "When would it be appropriate to use a locking compound on chassis fasteners?",
                    options: [
                        "On all fasteners as a precaution",
                        "Only on fasteners that are difficult to access",
                        "When specified by the manufacturer or when fasteners are subject to vibration",
                        "Only when reusing old fasteners"
                    ],
                    correctAnswer: 2,
                    explanation: "Locking compounds should be used when specified by the manufacturer or on fasteners subject to vibration, to prevent them from loosening during vehicle operation."
                },
                {
                    question: "What is the correct order of operations when replacing suspension components?",
                    options: [
                        "Remove, inspect, replace, test",
                        "Test, remove, replace, test again",
                        "Plan, protect, remove, replace, test, clean",
                        "Diagnose, order parts, remove, replace"
                    ],
                    correctAnswer: 2,
                    explanation: "The correct order is to plan the job, protect surrounding components, remove the faulty parts, replace with new components, test the system, and clean up the work area."
                },
                {
                    question: "Why is it important to check a vehicle's wheel alignment after replacing suspension components?",
                    options: [
                        "It's a legal requirement",
                        "To prevent abnormal tyre wear and ensure correct handling",
                        "Only if the customer requests it",
                        "Only for high-performance vehicles"
                    ],
                    correctAnswer: 1,
                    explanation: "Checking wheel alignment after suspension work is crucial to prevent abnormal tyre wear, ensure correct vehicle handling, and maintain steering stability and safety."
                }
            ]
        };
        
        // User theme preferences
        let userTheme = 'light';
        
        // Initialize the app
        function init() {
            loadUserProgress();
            loadUserTheme();
            bindEvents();
            showView('topic-selection'); // Changed to start with topic selection as landing page
        }
        
        // Load saved user progress from localStorage
        function loadUserProgress() {
            const savedProgress = localStorage.getItem('chassisQuizProgress');
            if (savedProgress) {
                try {
                    userProgress = JSON.parse(savedProgress);
                } catch (e) {
                    console.error('Error loading saved progress:', e);
                    userProgress = { topics: {} };
                }
            } else {
                userProgress = { topics: {} };
            }
        }
        
        // Load user theme preference
        function loadUserTheme() {
            const savedTheme = localStorage.getItem('chassisQuizTheme');
            if (savedTheme) {
                userTheme = savedTheme;
                applyTheme(userTheme);
            }
        }
        
        // Save user theme preference
        function saveUserTheme(theme) {
            userTheme = theme;
            localStorage.setItem('chassisQuizTheme', theme);
        }
        
        // Apply the selected theme
        function applyTheme(theme) {
            // First remove any existing theme classes
            document.body.classList.remove('theme-light', 'theme-dark', 'theme-contrast', 'theme-colorblind');
            
            // Add the new theme class
            document.body.classList.add(`theme-${theme}`);
            
            // Update active button state
            const themeButtons = document.querySelectorAll('.theme-btn');
            themeButtons.forEach(btn => btn.classList.remove('theme-btn-active'));
            document.getElementById(`${theme}-theme`).classList.add('theme-btn-active');
            
            // Force immediate style refresh for all cards
            const allCards = document.querySelectorAll('.topic-card, .progress-card');
            allCards.forEach(card => {
                // Force style refresh
                card.style.color = (theme === 'light' || theme === 'colorblind') ? '#212121' : '#ffffff';
                
                // Ensure background color is appropriate
                card.style.backgroundColor = (theme === 'light' || theme === 'colorblind') ? 
                    '#ffffff' : (theme === 'dark' ? '#2c2c2c' : '#222222');
                
                // Apply to all text elements
                const textElements = card.querySelectorAll('p, div:not(.topic-progress):not(.topic-progress-bar), span');
                textElements.forEach(el => {
                    el.style.color = (theme === 'light' || theme === 'colorblind') ? 
                        '#212121' : '#ffffff';
                });
                
                // Special styling for headers
                const headers = card.querySelectorAll('.topic-header, h3');
                headers.forEach(el => {
                    if (theme === 'contrast') {
                        el.style.color = '#ffcc00';
                    } else if (theme === 'dark') {
                        el.style.color = '#42a5f5';
                    } else if (theme === 'colorblind') {
                        el.style.color = '#0072B2';
                    } else {
                        el.style.color = '#1976d2';
                    }
                });
            });
            
            // Apply theme-specific CSS variables based on theme
            const root = document.documentElement;
            
            switch(theme) {
                case 'light':
                    root.style.setProperty('--primary', '#1976d2');
                    root.style.setProperty('--primary-dark', '#0d47a1');
                    root.style.setProperty('--secondary', '#2e7d32');
                    root.style.setProperty('--secondary-dark', '#1b5e20');
                    root.style.setProperty('--danger', '#d32f2f');
                    root.style.setProperty('--success', '#2e7d32');
                    root.style.setProperty('--dark', '#212121');
                    root.style.setProperty('--light', '#f5f5f5');
                    root.style.setProperty('--gray', '#757575');
                    root.style.setProperty('--light-gray', '#e0e0e0');
                    root.style.setProperty('--bg-color', '#f5f5f5');
                    root.style.setProperty('--text-color', '#212121');
                    root.style.setProperty('--card-bg', '#ffffff');
                    root.style.setProperty('--card-text', '#212121');
                    root.style.setProperty('--option-bg', '#f5f5f5');
                    root.style.setProperty('--option-text', '#212121');
                    root.style.setProperty('--selected-bg', 'rgba(25, 118, 210, 0.1)');
                    root.style.setProperty('--correct-bg', 'rgba(46, 125, 50, 0.15)');
                    root.style.setProperty('--incorrect-bg', 'rgba(211, 47, 47, 0.15)');
                    break;
                    
                case 'dark':
                    root.style.setProperty('--primary', '#42a5f5');
                    root.style.setProperty('--primary-dark', '#1e88e5');
                    root.style.setProperty('--secondary', '#66bb6a');
                    root.style.setProperty('--secondary-dark', '#43a047');
                    root.style.setProperty('--danger', '#ef5350');
                    root.style.setProperty('--success', '#66bb6a');
                    root.style.setProperty('--dark', '#f5f5f5');
                    root.style.setProperty('--light', '#212121');
                    root.style.setProperty('--gray', '#9e9e9e');
                    root.style.setProperty('--light-gray', '#424242');
                    root.style.setProperty('--bg-color', '#121212');
                    root.style.setProperty('--text-color', '#f5f5f5');
                    root.style.setProperty('--card-bg', '#2c2c2c'); // Darker background for cards
                    root.style.setProperty('--card-text', '#ffffff'); // White text on dark background
                    root.style.setProperty('--option-bg', '#333333');
                    root.style.setProperty('--option-text', '#f5f5f5');
                    root.style.setProperty('--selected-bg', 'rgba(66, 165, 245, 0.25)');
                    root.style.setProperty('--correct-bg', 'rgba(102, 187, 106, 0.25)');
                    root.style.setProperty('--incorrect-bg', 'rgba(239, 83, 80, 0.25)');
                    
                    // Add a class to the body for theme-specific styles
                    document.body.classList.add('theme-dark');
                    break;
                    
                case 'contrast':
                    root.style.setProperty('--primary', '#ffcc00');
                    root.style.setProperty('--primary-dark', '#e6b800');
                    root.style.setProperty('--secondary', '#00ff00');
                    root.style.setProperty('--secondary-dark', '#00cc00');
                    root.style.setProperty('--danger', '#ff0000');
                    root.style.setProperty('--success', '#00ff00');
                    root.style.setProperty('--dark', '#ffffff');
                    root.style.setProperty('--light', '#000000');
                    root.style.setProperty('--gray', '#ffffff');
                    root.style.setProperty('--light-gray', '#333333');
                    root.style.setProperty('--bg-color', '#000000');
                    root.style.setProperty('--text-color', '#ffffff');
                    root.style.setProperty('--card-bg', '#222222'); // Dark gray for cards
                    root.style.setProperty('--card-text', '#ffffff'); // White text
                    root.style.setProperty('--option-bg', '#000000');
                    root.style.setProperty('--option-text', '#ffffff');
                    root.style.setProperty('--selected-bg', '#000000');
                    root.style.setProperty('--correct-bg', '#005500');
                    root.style.setProperty('--incorrect-bg', '#550000');
                    
                    // Add a class to the body for theme-specific styles
                    document.body.classList.add('theme-contrast');
                    break;
                    
                case 'colorblind':
                    root.style.setProperty('--primary', '#0072B2'); // Blue (distinguishable for protanopia, deuteranopia)
                    root.style.setProperty('--primary-dark', '#005b8f');
                    root.style.setProperty('--secondary', '#E69F00'); // Orange (better for most types of colorblindness)
                    root.style.setProperty('--secondary-dark', '#b37e00');
                    root.style.setProperty('--danger', '#CC79A7'); // Pink/Purple (visible for most colorblindness)
                    root.style.setProperty('--success', '#009E73'); // Teal (distinguishable for most colorblindness)
                    root.style.setProperty('--dark', '#212121');
                    root.style.setProperty('--light', '#f5f5f5');
                    root.style.setProperty('--gray', '#707070');
                    root.style.setProperty('--light-gray', '#e0e0e0');
                    root.style.setProperty('--bg-color', '#f5f5f5');
                    root.style.setProperty('--text-color', '#212121');
                    root.style.setProperty('--card-bg', '#ffffff');
                    root.style.setProperty('--card-text', '#212121');
                    root.style.setProperty('--option-bg', '#f5f5f5');
                    root.style.setProperty('--option-text', '#212121');
                    root.style.setProperty('--selected-bg', 'rgba(0, 114, 178, 0.15)');
                    root.style.setProperty('--correct-bg', 'rgba(0, 158, 115, 0.15)');
                    root.style.setProperty('--incorrect-bg', 'rgba(204, 121, 167, 0.15)');
                    
                    // Add a class to the body for theme-specific styles
                    document.body.classList.add('theme-colorblind');
                    break;
            }
        }
        
        // Save user progress to localStorage
        function saveUserProgress() {
            localStorage.setItem('chassisQuizProgress', JSON.stringify(userProgress));
        }
        
        // Reset all user progress
        function resetUserProgress() {
            // Show confirmation dialog
            const confirmDialog = document.createElement('div');
            confirmDialog.className = 'confirmation-dialog';
            confirmDialog.innerHTML = `
                <div class="dialog-content">
                    <h3>Reset All Progress?</h3>
                    <p>This will delete all your saved progress and scores. This action cannot be undone.</p>
                    <div class="dialog-buttons">
                        <button id="confirm-reset" class="btn btn-danger">Reset</button>
                        <button id="cancel-reset" class="btn">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDialog);
            
            // Add event listeners to dialog buttons
            document.getElementById('confirm-reset').addEventListener('click', () => {
                userProgress = { topics: {} };
                saveUserProgress();
                document.body.removeChild(confirmDialog);
                showView('home');
            });
            
            document.getElementById('cancel-reset').addEventListener('click', () => {
                document.body.removeChild(confirmDialog);
            });
        }
        
        // Bind event listeners
        function bindEvents() {
            startBtn.addEventListener('click', () => showView('topic-selection'));
            restartBtn.addEventListener('click', restartQuiz);
            submitBtn.addEventListener('click', submitAnswer);
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', previousQuestion);
            progressBtn.addEventListener('click', () => showView('progress'));
            resetBtn.addEventListener('click', resetUserProgress);
            document.getElementById('back-to-topics-btn').addEventListener('click', () => showView('topic-selection'));
            document.getElementById('back-to-topics-from-results').addEventListener('click', () => showView('topic-selection'));
            
            // Theme toggle buttons
            document.getElementById('light-theme').addEventListener('click', () => {
                applyTheme('light');
                saveUserTheme('light');
            });
            
            document.getElementById('dark-theme').addEventListener('click', () => {
                applyTheme('dark');
                saveUserTheme('dark');
            });
            
            document.getElementById('contrast-theme').addEventListener('click', () => {
                applyTheme('contrast');
                saveUserTheme('contrast');
            });
            
            document.getElementById('colorblind-theme').addEventListener('click', () => {
                applyTheme('colorblind');
                saveUserTheme('colorblind');
            });
            
            if (document.getElementById('back-to-topics')) {
                document.getElementById('back-to-topics').addEventListener('click', () => showView('topic-selection'));
            }
        }
        
        // Show/hide views
        function showView(view) {
            homeScreen.classList.add('hidden');
            topicSelection.classList.add('hidden');
            questionScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            progressScreen.classList.add('hidden');
            
            switch(view) {
                case 'home':
                    homeScreen.classList.remove('hidden');
                    break;
                case 'topic-selection':
                    topicSelection.classList.remove('hidden');
                    renderTopics();
                    break;
                case 'question':
                    questionScreen.classList.remove('hidden');
                    renderQuestion();
                    break;
                case 'results':
                    resultsScreen.classList.remove('hidden');
                    renderResults();
                    break;
                case 'progress':
                    progressScreen.classList.remove('hidden');
                    renderOverallProgress();
                    break;
            }
            
            currentView = view;
        }
        
        // Render topic selection
        function renderTopics() {
            topicGrid.innerHTML = '';
            
            topics.forEach(topic => {
                const topicCard = document.createElement('div');
                topicCard.className = 'topic-card';
                
                // Check if there is saved progress for this topic
                const topicProgress = userProgress.topics[topic.id];
                let completedQuestions = 0;
                let totalQuestions = 0;
                let progressPercentage = 0;
                let topicScore = 0;
                let statusClass = 'status-not-started';
                let statusText = 'Not Started';
                
                if (topicProgress && topicProgress.answers) {
                    totalQuestions = topicProgress.answers.length;
                    
                    topicProgress.answers.forEach(answer => {
                        if (answer !== null) completedQuestions++;
                    });
                    
                    topicScore = topicProgress.score || 0;
                    progressPercentage = (completedQuestions / totalQuestions) * 100;
                    
                    if (completedQuestions === 0) {
                        statusClass = 'status-not-started';
                        statusText = 'Not Started';
                    } else if (completedQuestions < totalQuestions) {
                        statusClass = 'status-in-progress';
                        statusText = 'In Progress';
                    } else {
                        statusClass = 'status-completed';
                        statusText = 'Completed';
                    }
                } else if (topic.id !== 'random') {
                    // If no progress and not the random topic, set default question count
                    totalQuestions = questionsData[topic.id].length;
                }
                
                // Status badge
                const statusBadge = document.createElement('div');
                statusBadge.className = `topic-status ${statusClass}`;
                statusBadge.textContent = statusText;
                topicCard.appendChild(statusBadge);
                
                // Topic header - ensure the text color is appropriate for the theme
                const topicHeader = document.createElement('div');
                topicHeader.className = 'topic-header';
                topicHeader.textContent = topic.name;
                topicCard.appendChild(topicHeader);
                
                // Count of questions - ensure the text color is appropriate for the theme
                if (topic.id !== 'random') {
                    const questionsCount = document.createElement('div');
                    questionsCount.className = 'topic-progress-info';
                    questionsCount.innerHTML = `
                        <span>Questions:</span>
                        <span>${completedQuestions}/${totalQuestions}</span>
                    `;
                    topicCard.appendChild(questionsCount);
                    
                    // Score (if attempted) - ensure the text color is appropriate for the theme
                    if (completedQuestions > 0) {
                        const scorePercentage = Math.round((topicScore / totalQuestions) * 100);
                        const scoreElement = document.createElement('div');
                        scoreElement.className = 'topic-score';
                        scoreElement.textContent = `Score: ${scorePercentage}%`;
                        topicCard.appendChild(scoreElement);
                    }
                    
                    // Progress bar
                    const progressBarContainer = document.createElement('div');
                    progressBarContainer.className = 'topic-progress';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'topic-progress-bar';
                    progressBar.style.width = `${progressPercentage}%`;
                    
                    progressBarContainer.appendChild(progressBar);
                    topicCard.appendChild(progressBarContainer);
                } else {
                    // For random topic, show a special description - ensure text color is appropriate for the theme
                    const randomDescription = document.createElement('p');
                    randomDescription.style.fontSize = '14px';
                    randomDescription.style.marginTop = '10px';
                    randomDescription.className = 'topic-description';
                    randomDescription.textContent = 'Mix of questions from all topics';
                    topicCard.appendChild(randomDescription);
                }
                
                topicCard.addEventListener('click', () => selectTopic(topic.id));
                topicGrid.appendChild(topicCard);
            });
        }
        
        // Select a topic
        function selectTopic(topicId) {
            currentTopic = topicId;
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            quizCompleted = false;
            
            if (topicId === 'random') {
                // Create a random mix of questions from all topics
                quizQuestions = [];
                const allTopics = Object.keys(questionsData).filter(topic => topic !== 'random');
                
                // Get 2 questions from each topic
                allTopics.forEach(topic => {
                    const topicQuestions = [...questionsData[topic]];
                    shuffleArray(topicQuestions);
                    quizQuestions.push(...topicQuestions.slice(0, 2));
                });
                
                shuffleArray(quizQuestions);
            } else {
                quizQuestions = [...questionsData[topicId]];
                shuffleArray(quizQuestions);
            }
            
            // Check if there's saved progress
            if (userProgress.topics[topicId] && topicId !== 'random') {
                // If we have saved answers for this exact set of questions, use them
                if (userProgress.topics[topicId].answers && 
                    userProgress.topics[topicId].answers.length === quizQuestions.length) {
                    userAnswers = [...userProgress.topics[topicId].answers];
                    score = userProgress.topics[topicId].score || 0;
                    
                    // Find the first unanswered question
                    for (let i = 0; i < userAnswers.length; i++) {
                        if (userAnswers[i] === null) {
                            currentQuestionIndex = i;
                            break;
                        }
                    }
                } else {
                    // If the questions have changed, start fresh
                    userAnswers = Array(quizQuestions.length).fill(null);
                }
            } else {
                // Initialize userAnswers array
                userAnswers = Array(quizQuestions.length).fill(null);
            }
            
            showView('question');
        }
        
        // Render current question
        function renderQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            
            // Update question text
            questionText.textContent = `Question ${currentQuestionIndex + 1} of ${quizQuestions.length}: ${question.question}`;
            
            // Update options
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                
                // Check if this option was previously selected
                if (userAnswers[currentQuestionIndex] === index) {
                    optionElement.classList.add('selected');
                    selectedAnswer = index;
                }
                
                // If answer was submitted, show correct/incorrect
                if (answerSubmitted) {
                    if (index === question.correctAnswer) {
                        optionElement.classList.add('correct');
                    } else if (index === selectedAnswer) {
                        optionElement.classList.add('incorrect');
                    }
                }
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update explanation
            explanation.textContent = question.explanation;
            explanation.classList.toggle('hidden', !answerSubmitted);
            
            // Update buttons
            prevBtn.classList.toggle('hidden', currentQuestionIndex === 0);
            nextBtn.classList.toggle('hidden', !answerSubmitted);
            submitBtn.classList.toggle('hidden', answerSubmitted);
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        // Select an option
        function selectOption(index) {
            if (answerSubmitted) return;
            
            selectedAnswer = index;
            
            // Update UI
            const options = optionsContainer.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            // Just save the selected option, not submitting yet
            userAnswers[currentQuestionIndex] = selectedAnswer;
            if (currentTopic !== 'random') {
                saveQuizProgress();
            }
        }
        
        // Submit answer
        function submitAnswer() {
            if (selectedAnswer === null) {
                alert('Please select an answer');
                return;
            }
            
            answerSubmitted = true;
            userAnswers[currentQuestionIndex] = selectedAnswer;
            
            const question = quizQuestions[currentQuestionIndex];
            if (selectedAnswer === question.correctAnswer) {
                score++;
            }
            
            // Update UI
            const options = optionsContainer.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correctAnswer) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && selectedAnswer !== question.correctAnswer) {
                    option.classList.add('incorrect');
                }
            });
            
            explanation.classList.remove('hidden');
            submitBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            
            // Check if this is the last question
            if (currentQuestionIndex === quizQuestions.length - 1) {
                nextBtn.textContent = 'View Results';
                quizCompleted = true;
            }
            
            // Save progress
            saveQuizProgress();
        }
        
        // Save current quiz progress
        function saveQuizProgress() {
            if (currentTopic === 'random') return; // Don't save progress for random quizzes
            
            // Update or create topic progress
            userProgress.topics[currentTopic] = {
                answers: [...userAnswers],
                score: score,
                totalQuestions: quizQuestions.length,
                lastAttempt: new Date().toISOString()
            };
            
            // Save to localStorage
            saveUserProgress();
        }
        
        // Go to next question
        function nextQuestion() {
            if (quizCompleted) {
                showView('results');
                return;
            }
            
            answerSubmitted = false;
            selectedAnswer = null;
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= quizQuestions.length) {
                showView('results');
            } else {
                renderQuestion();
            }
        }
        
        // Go to previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                answerSubmitted = userAnswers[currentQuestionIndex] !== null;
                selectedAnswer = userAnswers[currentQuestionIndex];
                renderQuestion();
            }
        }
        
        // Render results
        function renderResults() {
            scoreElement.textContent = score;
            totalElement.textContent = quizQuestions.length;
            
            const percentage = Math.round((score / quizQuestions.length) * 100);
            let feedback = '';
            
            if (percentage >= 80) {
                feedback = 'Excellent! You have a strong understanding of the material.';
            } else if (percentage >= 60) {
                feedback = 'Good job! Review the questions you missed to improve further.';
            } else {
                feedback = 'You need more practice. Focus on reviewing the topic areas where you missed questions.';
            }
            
            resultDetails.innerHTML = `
                <p>${feedback}</p>
                <p>You scored ${percentage}% (${score} out of ${quizQuestions.length}).</p>
            `;
            
            // Add topic-specific feedback
            if (currentTopic !== 'random') {
                resultDetails.innerHTML += `
                    <p>Topic: ${topics.find(t => t.id === currentTopic).name}</p>
                `;
            }
        }
        
        // Restart quiz
        function restartQuiz() {
            showView('topic-selection');
        }
        
        // Render overall progress
        function renderOverallProgress() {
            progressDetailsContainer.innerHTML = '';
            
            // Create overall progress summary
            let totalQuestions = 0;
            let totalAnswered = 0;
            let totalCorrect = 0;
            
            // Calculate overall statistics
            Object.keys(userProgress.topics).forEach(topicId => {
                const topic = userProgress.topics[topicId];
                if (topic.answers) {
                    totalQuestions += topic.answers.length;
                    
                    topic.answers.forEach(answer => {
                        if (answer !== null) totalAnswered++;
                    });
                    
                    totalCorrect += topic.score || 0;
                }
            });
            
            // Create overall progress card
            const overallCard = document.createElement('div');
            overallCard.className = 'overall-progress';
            
            if (totalQuestions > 0) {
                const completionPercentage = Math.round((totalAnswered / totalQuestions) * 100);
                const correctPercentage = Math.round((totalCorrect / totalQuestions) * 100);
                
                overallCard.innerHTML = `
                    <h3>Overall Progress</h3>
                    <div class="progress-stat">
                        <span>Completion:</span>
                        <span>${completionPercentage}% (${totalAnswered}/${totalQuestions})</span>
                    </div>
                    <div class="progress-stat">
                        <span>Correct Answers:</span>
                        <span>${correctPercentage}% (${totalCorrect}/${totalQuestions})</span>
                    </div>
                    <div class="topic-progress" style="margin-top: 15px; height: 10px;">
                        <div class="topic-progress-bar" style="width: ${completionPercentage}%; background-color: var(--primary);"></div>
                    </div>
                `;
            } else {
                overallCard.innerHTML = `
                    <h3>Overall Progress</h3>
                    <p>You haven't attempted any quizzes yet.</p>
                `;
            }
            
            progressDetailsContainer.appendChild(overallCard);
            
            // Create progress cards for each topic
            const topicsContainer = document.createElement('div');
            topicsContainer.className = 'topics-progress-grid';
            topicsContainer.style.display = 'grid';
            topicsContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(230px, 1fr))';
            topicsContainer.style.gap = '15px';
            topicsContainer.style.marginTop = '20px';
            
            // Sort topics by completion percentage
            const topicSummaries = [];
            
            topics.forEach(topic => {
                if (topic.id === 'random') return; // Skip random topic
                
                const topicProgress = userProgress.topics[topic.id];
                if (!topicProgress || !topicProgress.answers || topicProgress.answers.length === 0) {
                    // Add not-started topics with 0%
                    topicSummaries.push({
                        id: topic.id,
                        name: topic.name,
                        completion: 0,
                        correct: 0,
                        answeredQuestions: 0,
                        totalQuestions: questionsData[topic.id].length,
                        lastAttempt: null
                    });
                    return;
                }
                
                // Calculate topic statistics
                let answeredQuestions = 0;
                topicProgress.answers.forEach(answer => {
                    if (answer !== null) answeredQuestions++;
                });
                
                const completion = Math.round((answeredQuestions / topicProgress.answers.length) * 100);
                const correct = Math.round((topicProgress.score / topicProgress.answers.length) * 100);
                
                topicSummaries.push({
                    id: topic.id,
                    name: topic.name,
                    completion,
                    correct,
                    answeredQuestions,
                    totalQuestions: topicProgress.answers.length,
                    lastAttempt: topicProgress.lastAttempt
                });
            });
            
            // Sort by completion (highest first)
            topicSummaries.sort((a, b) => b.completion - a.completion);
            
            topicSummaries.forEach(summary => {
                const topicCard = document.createElement('div');
                topicCard.className = 'progress-card';
                
                // Set card border color based on completion
                if (summary.completion === 100) {
                    topicCard.style.borderLeft = '4px solid var(--secondary)';
                } else if (summary.completion > 0) {
                    topicCard.style.borderLeft = '4px solid var(--primary)';
                } else {
                    topicCard.style.borderLeft = '4px solid var(--gray)';
                }
                
                // Format last attempt date
                const lastAttempt = summary.lastAttempt ? 
                    new Date(summary.lastAttempt).toLocaleDateString() : 'Never';
                
                // Add status badge
                let statusClass = 'status-not-started';
                let statusText = 'Not Started';
                
                if (summary.completion === 0) {
                    statusClass = 'status-not-started';
                    statusText = 'Not Started';
                } else if (summary.completion < 100) {
                    statusClass = 'status-in-progress';
                    statusText = 'In Progress';
                } else {
                    statusClass = 'status-completed';
                    statusText = 'Completed';
                }
                
                topicCard.innerHTML = `
                    <div class="topic-status ${statusClass}" style="position: absolute; top: 0; right: 0;">
                        ${statusText}
                    </div>
                    <h3>${summary.name}</h3>
                    <div class="progress-stat">
                        <span>Completion:</span>
                        <span>${summary.completion}% (${summary.answeredQuestions}/${summary.totalQuestions})</span>
                    </div>
                    ${summary.completion > 0 ? `
                    <div class="progress-stat">
                        <span>Correct:</span>
                        <span>${summary.correct}%</span>
                    </div>
                    <div class="progress-stat">
                        <span>Last Attempt:</span>
                        <span>${lastAttempt}</span>
                    </div>
                    ` : ''}
                    <div class="topic-progress" style="margin-top: 10px;">
                        <div class="topic-progress-bar" style="width: ${summary.completion}%"></div>
                    </div>
                `;
                
                topicCard.style.position = 'relative';
                topicCard.style.cursor = 'pointer';
                
                // Make the card clickable to go to that topic
                topicCard.addEventListener('click', () => {
                    selectTopic(summary.id);
                });
                
                topicsContainer.appendChild(topicCard);
            });
            
            progressDetailsContainer.appendChild(topicsContainer);
        }
        
        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
